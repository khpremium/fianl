<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="board" >
    
	<select id="dataCount" resultType="int">
      select count(*) from board where b_category_c_num = 2
	</select>
	
	<select id="cityCount" parameterType="String"  resultType="int">
	  select count(*) from board where b_category_c_num = 2 and city_code=#{city_code}
	</select>	

	<select id="mostLiked" resultType="dto.BoardDTO">	
	  <![CDATA[
       SELECT * FROM board WHERE b_like = (SELECT max(b_like) FROM board where b_category_c_num = 2) and b_category_c_num = 2  order by b_num desc
	  ]]>
	</select>
	
	<select id="mostLikedCity" parameterType="String" resultType="dto.BoardDTO">	
	  <![CDATA[
			 select b.* from
			(select rownum as rs, a.*  from
			(select * from board where b_category_c_num=2 and city_code=#{city_code} order by b_like desc)a)b
			where b.rs=1
	  ]]>		
	</select>

	<select id="listAll"  resultType="dto.BoardDTO" parameterType="dto.PageDTO" >   
   <![CDATA[

	 select b.* from
     (select rownum as rm, a.* from(
     select * from board where b_category_c_num=2 order by b_num desc)a)b
     where b.rm>=#{startRow} and b.rm<=#{endRow}
	]]>
	</select>
	
	
	<!-- 수정 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ,DTO에  city code 넣어주기  -->
	<select id="list" parameterType="dto.PageDTO"  resultType="dto.BoardDTO">   
   <![CDATA[ 
	 select b.* from
     (select rownum as rm, a.* from(
     select * from board where city_code=#{city_code} and b_category_c_num=2 order by b_num desc)a)b
     where b.rm>=#{startRow} and b.rm<=#{endRow}
	]]>
	</select>
	
	<select id="view" parameterType="int" 
	        resultType="dto.BoardDTO">
	 select * from board where b_num=#{b_num}
	</select>
	
	<insert id="boardWrite" parameterType="dto.BoardDTO" >
		<selectKey resultType="int" keyProperty="b_num" order="BEFORE">
			select board_b_num_seq.nextval from dual
		</selectKey>
		insert into board
		values(#{b_num},#{b_content},null,0,0,#{user_id},#{city_code},2,#{title},sysdate)
	</insert>  
	
	<select id="listSearch" resultType="dto.BoardDTO" parameterType="dto.PageDTO">  
     <![CDATA[ 
	 select b.* from
     (select rownum as rm, a.* from(
     select * from board where (title like '%' || #{searchWord} || '%' or b_content like '%' || #{searchWord} || '%') and b_category_c_num =2 order by b_num desc)a)b
     where b.rm>=#{startRow} and b.rm<=#{endRow} 
	 ]]>  
    </select>
    
    <select id="searchCount" parameterType="dto.PageDTO"  resultType="int">
	  select count(*) from board where (title like '%' || #{searchWord} || '%') or (b_content like '%' || #{searchWord} || '%') and b_category_c_num = 2 
	</select>	
	
    </mapper>